# 无人船调试总结

---

[TOC]

## 一、整体配置

### 1.所需设备及各部分功能简述

- 工控机（`Intel NUC`）
  - 与船上主控连接
  - 运行算法
  - 向船主控发送命令以及获取船运行信息
- PC：远程控制工控机
- 随行Wi-Fi：放在船里，工控机连接（没有就用手机开热点）

### 2. 网络配置详述

> 关于整体配置有两种方案，下面先详述我们这次用到的方案，在后面会叙述另一种方案以及各自的特点

#### ①前期硬件配置

- 首先把工控机放在船上，通过网线与船上的交换机连接
- 对于工控机的电源，之前是直接连充电宝，这次是云洲有220V电源，放在船上后直接用一起配套的变压器连接后供电即可
- 随行Wi-Fi放在船里，把工控机连上显示器，配置工控机连好Wi-Fi，如果没有就手机开热点之后把手机放在船里
- 我们使用的远程控制软件是向日葵，两边都安装并启动后，在岸上开启远程控制
- 之后就可以把工控机的显示器拔下来，放在船上放好
- 至此，硬件上的连接都已就绪

#### ②岸上通信配置

==以下操作实际上是在工控机上运行的，但是我们通过远程软件在岸上的PC上控制==

- 船的默认IP地址是`192.168.0.230`，这个时候要看一下自己的IP地址，比如最开始我们的是`192.168.1.110`,但这个时候是无法ping通船的，因为工控机和船不在一个网段（IP地址第三段），这个时候我们是找云洲的人帮忙改一下船上主控IP让他在一个网段内（改成`192.168.1.230`），之后就可以连接了
- 安装mqtt（这个在工控机上已经安装）

> ​		以上是我们用的配置方案，另外一种方案是工控机不放在船上而是放在岸上，把网线插到一个云洲那里类似于路由器的机器上（有天线，但只有一个网线接口），此时这个机器就像路由器一样可以发送5GHz的网络信号，船主控可以连接到这个网络，在之后需要一个交换机，把工控机和这个连接到一起，再进行控制。使用这种办法就不需要PC了，直接在工控机连接显示器就可以完成后面的工作了，但是由于算法、数据处理都是跑在工控机上的，不像前面是有线连接，这种无线连接有可能会延时比较大或者一旦丢包后果可能比较严重，不是特别稳，所以我们选择了前面那个比较稳妥的办法。

## 二、感知

> 所有感知信息都是通过mqtt通信建立工控机和船的连接，但是由于船上的数据编码方式和我们的电脑不一致，所以得到的原始数据直接显示会乱码，需要进行解码

### 1. 船状态

```sh
mosquitto_sub -h 192.168.1.230 -p 1883 -t "/status" -v
```

<img src="http://www.hz-heze.com/wp-content/uploads/2020/08/image-20200803224006655.png" alt="image-20200803224006655" style="zoom:67%;" />

### 2. GPS

```sh
mosquitto_sub -h 192.168.1.230 -p 1883 -t "/gps" -v
```

<img src="http://www.hz-heze.com/wp-content/uploads/2020/08/image-20200803224039879.png" alt="image-20200803224039879" style="zoom:67%;" />

### 3. 姿态

```sh
mosquitto_sub -h 192.168.1.230 -p 1883 -t "/pose" -v
```

![image-20200803224109831](http://www.hz-heze.com/wp-content/uploads/2020/08/image-20200803224109831.png)

### 4. 速度与航向

```sh
mosquitto_sub -h 192.168.1.230 -p 1883 -t "/vtg" -v
```

<img src="http://www.hz-heze.com/wp-content/uploads/2020/08/image-20200803224237746.png" alt="image-20200803224237746" style="zoom:67%;" />

### 5. 船头朝向

```sh
mosquitto_sub -h 192.168.1.230 -p 1883 -t "/hdt" -v
```

<img src="http://www.hz-heze.com/wp-content/uploads/2020/08/image-20200803224355457.png" alt="image-20200803224355457" style="zoom:67%;" />

### 6. 探测目标

```sh
mosquitto_sub -h 192.168.1.230 -p 1883 -t "/radar/object" -v
```

<img src="http://www.hz-heze.com/wp-content/uploads/2020/08/image-20200803224536663.png" alt="image-20200803224536663" style="zoom:67%;" />